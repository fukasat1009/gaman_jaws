

<div class="topPage">
  <div class="container">
    <div class="container">
      <div class="row">
        <div class="col-6">
            <% array = [] %>
              <% @targets.each do |target| %>
                <% target.patiences.each do |patience| %>
                  <% array << patience.price.to_i %>
                <% end %>
              <% end %>
          <h1>Total GAMAN</h1>
          <div class="text-center">
            <h1>￥<%= array.sum %></h1>
            <h1>あなたのランクは...</h1>
            <% if 20000 <= array.sum %>
             <h1>チョウザメ</h1>
             <%= image_tag asset_path("tyouzame.png",alt: ""),width: "300px" %>
            <% else 10000 <= array.sum %>
              <h1>普通のサメ</h1>
              <%= image_tag asset_path("same.png",alt: ""),width: "300px" %>
            <% end %>

          </div>
        </div>

        <div class="col-6">
          <div class="topPage">
            <div class="targetWrapper">
              <% @targets.each do |target| %>
                <% if target.target_status == "挑戦中" %>
                  <div class="target">
                    <div class="target_header">
                      <h2 class="target_header_title"><%= link_to target.title ,target_path(target) %></h2>
                      <h2 class="target_header_title"><%= target.price %></h2>円
                        <div class="target_header_action">
                          <%= link_to(content_tag(:i, '', class: 'fas fa-pen'), edit_target_path(target)) %>
                          <%= link_to "削除する",target, method: :delete %>
                        </div>
                    </div>
                    <% array = [] %>
                      <div class="patienceWrapper">
                        <% target.patiences.each do |patience| %>
                          <% array << patience.price.to_i %>
                            <div class="patience">
                              <h3 class="patience_title">
                                <%= link_to patience.name, target_patience_path(target,patience) %>&nbsp;&nbsp;&nbsp;&nbsp;<%= patience.price %>円
                              </h3>
                            </div>
                      <div class="card_detail is-exist"><i class="fas fa-bars"></i></div>
                        <% end %>
                        <h6>我慢金額合計<%= array.sum %>円</h6>
                        <h6>達成まで<%= target.price.to_i - array.sum %>円</h6>
                       <% if target.price.to_i <= array.sum %>
                         <div class="atsu-mori" data-ruby="JAWS">我慢</div>
                       <% end %>
                       <%= link_to "さらに我慢を追加", new_target_patience_path(target) %>
                      </div>
                  </div>
                <% end %>
              <% end %>
            </div>
            <%= link_to "新しく目標を作る", new_target_path, class: "btn button-index" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


